syntax = "proto3";

import "google/protobuf/timestamp.proto";

package chat;

service Chat {
    rpc GetUserChats (UserId) returns (MultipleChats) {}
    rpc CreateGroupChat (CreateGroupChatRequest) returns (ChatId) {}
    rpc GetOrCreatePrivateChat (CreatePrivateChatRequest) returns (ChatId) {}
    rpc UpdateChat (UpdateChatRequest) returns (ChatId) {}
    rpc AddMembersToChat (AddMembersRequest) returns (ChatId) {}
    rpc GetChatData (ChatId) returns (ChatData) {}
    rpc DeleteUserChat (DeleteUserFromChatRequest) returns (DeleteResponse) {}
    rpc DeleteChat (ChatId) returns (DeleteResponse) {}
    rpc GetLastReadMessage (GetLastReadMessageRequest) returns (MessageId) {}
}

enum ChatType {
  GROUP = 0;           
  PRIVATE = 1;        
  CHANNEL = 2;         
  SAVED_MESSAGES = 3;   
}

message ChatId {
    int32 id = 1;
}

message UserId {
    int32 id = 1;
}

message ChatResponse {
  int32 id = 1;
  ChatType type = 2;          
  string title = 3;           
  optional string avatar = 4;
  optional string last_message = 5;
  optional google.protobuf.Timestamp last_message_at = 6;
  optional int32 interlocutor_id = 7;  
}

message MultipleChats {
    repeated ChatResponse chats = 1;
}

message CreateGroupChatRequest {
    string name = 1;
    repeated UserId members = 2;
    optional string avatar = 3;
}

message CreatePrivateChatRequest {
  int32 target_user_id = 1;
}

message UpdateChatRequest {
    int32 id = 1;
    optional string name = 2;
    optional string avatar = 3;
}

message AddMembersRequest {
    int32 id = 1;
    repeated UserId members = 2;
}

message ChatData {
    int32 id = 1;
    ChatType type = 2;
    string title = 3;          
    optional string avatar = 4;
    optional string last_message = 5;
    optional google.protobuf.Timestamp last_message_at = 6;
    repeated UserId members = 7; 
    google.protobuf.Timestamp created_at = 8;
    optional int32 interlocutor_id = 9; 
}

message DeleteUserFromChatRequest {
    int32 user_id = 1;
    int32 chat_id = 2;
}

message DeleteResponse {
    string status = 1;
}

message GetLastReadMessageRequest {
    int32 user_id = 1;
    int32 chat_id = 2;
}

message MessageId {
    optional string message_id = 1;
}
